<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROYAL OASIS | THE SOVEREIGN DYNASTY</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Plus+Jakarta+Sans:wght@300;600&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --bg: #030303;
            --gold: #D4AF37;
            --cyan-glow: #00FFCC; 
            --white: #E0E0E0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: var(--bg); color: var(--white); font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; text-align: center; }

        .top-nav { display: flex; justify-content: space-between; align-items: center; padding: 20px 5%; margin-top: 10px; }
        .nav-btn { text-decoration: none; color: var(--white); font-family: 'Cinzel'; font-size: 10px; letter-spacing: 2px; border: 1px solid rgba(255, 255, 255, 0.1); padding: 10px 18px; transition: 0.3s; background: transparent; cursor: pointer; }
        .nav-btn:hover { color: var(--cyan-glow); border-color: var(--cyan-glow); box-shadow: 0 0 15px rgba(0, 255, 204, 0.2); }
        .btn-buy-now { background: var(--cyan-glow); color: #000; font-weight: 900; border: none; }

        .royal-title { font-family: 'Cinzel'; font-size: clamp(30px, 6vw, 65px); font-weight: 900; color: var(--cyan-glow); letter-spacing: 12px; text-shadow: 0 0 30px rgba(0, 255, 204, 0.4); margin-top: 30px; }
        .sub-title { font-size: 9px; letter-spacing: 7px; color: #666; text-transform: uppercase; margin-bottom: 20px; display: block; }

        .canvas-container { max-width: 1100px; margin: 0 auto; padding: 20px; background: var(--bg); }
        .plot-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; }
        
        /* ইমেজ ফিটিং ফিক্স */
        .plot-card { aspect-ratio: 1/1; background: rgba(0, 255, 204, 0.05); border: 1px solid rgba(0, 255, 204, 0.2); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden; cursor: pointer; }
        .plot-card.occupied { background: #fff; border: 2px solid var(--gold); }
        
        /* ছবি পুরো ঘর জুড়ে দেখানোর জন্য */
        .plot-logo { width: 100%; height: 100%; object-fit: cover; display: block; }
        
        .plot-id { font-family: 'Cinzel'; font-size: 20px; color: var(--cyan-glow); font-weight: 900; }
        .plot-val { font-size: 9px; color: #444; margin-top: 4px; }

        .footer-legacy-info { margin-top: 30px; font-size: 9px; color: #555; letter-spacing: 1px; line-height: 1.6; padding: 0 20px; }
        .footer-legacy-info b { color: var(--gold); }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); display: none; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(15px); }
        .modal-box { background: #000; border: 1px solid var(--cyan-glow); padding: 40px; width: 90%; max-width: 450px; box-shadow: 0 0 50px rgba(0, 255, 204, 0.2); text-align: center; }
        input { width: 100%; padding: 15px; margin-bottom: 15px; background: #0a0a0a; border: 1px solid #333; color: #fff; outline: none; }
        .btn-submit { width: 100%; padding: 18px; background: var(--cyan-glow); color: #000; border: none; font-family: 'Cinzel'; font-weight: 900; cursor: pointer; }
        .success-msg { font-family: 'Cinzel'; color: var(--cyan-glow); font-size: 24px; letter-spacing: 2px; }
        .info-list { text-align: left; background: #0a0a0a; padding: 20px; margin: 20px 0; border: 1px solid #111; }
        .info-list li { font-size: 12px; color: #aaa; margin-bottom: 8px; list-style: none; border-left: 2px solid var(--gold); padding-left: 10px; }
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .btn-send { background: var(--gold); color: #000; padding: 15px; text-decoration: none; font-family: 'Cinzel'; font-weight: 900; font-size: 12px; }
        .btn-back { background: transparent; color: #555; border: 1px solid #222; padding: 15px; font-family: 'Cinzel'; cursor: pointer; }

        @media (max-width: 800px) { .plot-grid { grid-template-columns: repeat(3, 1fr); } .top-nav { flex-direction: column; gap: 10px; } }
    </style>
</head>
<body>

    <div class="top-nav">
        <a href="index.html" class="nav-btn">← MAIN HOME</a>
        <div style="display:flex; gap:10px;">
            <button class="nav-btn" onclick="exportCanvas()">DOWNLOAD MAP</button>
            <button class="nav-btn btn-buy-now" onclick="openOrderModal()">BUY PLOTS</button>
        </div>
    </div>

    <h1 class="royal-title">ROYAL OASIS</h1>
    <span class="sub-title">The Sovereign Dynasty Legacy</span>

    <div class="canvas-container" id="capture-area">
        <div class="plot-grid" id="mainGrid"></div>
        
        <div class="footer-legacy-info">
            © 2026 <b>ARK</b>. Owned by <b>KAWSAR</b>. All rights reserved. Top-tier legacy plots for Sovereign Dynasties. Includes Exclusive <b>NFT & Golden Title Deed</b>. Price: <b>$9,999</b>
        </div>
    </div>

    <div class="overlay" id="orderOverlay">
        <div class="modal-box" id="modalContent">
            <h2 style="font-family:'Cinzel'; color:var(--cyan-glow); margin-bottom:25px;">ACQUISITION</h2>
            <input type="text" id="custName" placeholder="BRAND / YOUR NAME">
            <input type="number" id="plotNum" placeholder="PLOT NUMBER (1-35)">
            <button class="btn-submit" onclick="initiateProtocol()">SUBMIT REQUEST</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCAdnfu2R82xbC7H85n_9mvQBE58X3TjbA",
            authDomain: "the-5k-elite-legacy.firebaseapp.com",
            databaseURL: "https://the-5k-elite-legacy-default-rtdb.firebaseio.com",
            projectId: "the-5k-elite-legacy",
            storageBucket: "the-5k-elite-legacy.firebasestorage.app",
            messagingSenderId: "440824313752",
            appId: "1:440824313752:web:2c93344dcfe2ba0a4c5ded"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function loadMap() {
            db.ref('royal_oasis_v2/live').on('value', snapshot => {
                const liveData = snapshot.val() || {};
                const grid = document.getElementById('mainGrid');
                grid.innerHTML = "";
                for (let i = 1; i <= 35; i++) {
                    const card = document.createElement('div');
                    if (liveData[i]) {
                        card.className = 'plot-card occupied';
                        card.innerHTML = `<img src="${liveData[i].imageUrl}" class="plot-logo">`;
                        
                        // লিঙ্ক ফিক্স: ক্লিক করলে নতুন ট্যাবে যাবে
                        card.onclick = function() {
                            const target = liveData[i].link;
                            if (target && target !== "#") {
                                const validUrl = target.startsWith('http') ? target : 'https://' + target;
                                window.open(validUrl, '_blank');
                            }
                        };
                    } else {
                        card.className = 'plot-card';
                        card.innerHTML = `<span class="plot-id">${i}</span><span class="plot-val">$9,999</span>`;
                    }
                    grid.appendChild(card);
                }
            });
        }

        function openOrderModal() { document.getElementById('orderOverlay').style.display = 'flex'; }

        function initiateProtocol() {
            const name = document.getElementById('custName').value;
            const pNo = document.getElementById('plotNum').value;
            if(!name || !pNo || pNo < 1 || pNo > 35) return alert("Please enter valid Name and Plot No");

            const content = document.getElementById('modalContent');
            content.innerHTML = `<div class="success-msg">CONGRATULATIONS!<br><span style="color:#fff; font-size:14px;">${name}</span></div>`;
            confetti({ particleCount: 250, spread: 100, origin: { y: 0.5 }, zIndex: 2000, colors: ['#00FFCC', '#D4AF37', '#ffffff'] });

            setTimeout(() => {
                const waMessage = window.encodeURIComponent(`Hello Support,\nI want to purchase a plot.\n\nDetails:\n- Plot Number: ${pNo}\n- Brand Name: ${name}\n- Price: $9,999\n- Package: Exclusive NFT & Golden Title Deed`);
                const waLink = `https://wa.me/8801576940717?text=${waMessage}`;

                content.innerHTML = `
                    <h2 style="font-family:'Cinzel'; color:var(--gold); font-size:18px;">SUPPORT PROTOCOL</h2>
                    <div class="info-list">
                        <li>Submit your Website/Social Link</li>
                        <li>Provide your Brand Logo (HD)</li>
                        <li>Complete Payment for Plot #${pNo} ($9,999)</li>
                    </div>
                    <div class="action-grid">
                        <a href="${waLink}" target="_blank" class="btn-send">SEND MESSAGE</a>
                        <button class="btn-back" onclick="location.reload()">BACK</button>
                    </div>
                `;
            }, 3000);

            db.ref('royal_oasis_v2/orders/' + Date.now()).set({ brand: name, plot: pNo, price: 9999, timestamp: Date.now() });
        }

        function exportCanvas() {
            const area = document.getElementById('capture-area');
            html2canvas(area, { backgroundColor: '#030303', scale: 4, useCORS: true, logging: false }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'Royal-Oasis-Ultra-HD.png';
                link.href = canvas.toDataURL("image/png", 1.0);
                link.click();
            });
        }

        window.onload = loadMap;
    </script>
</body>
</html>
